import{D as w}from"./DefaultButton-CSxnAuWH.js";import{m as D}from"./midtrans-CL9d1pBS.js";import{f as c}from"./fieldValidation-2uvnKSNg.js";import{p,g as b,b as s,t as g,c as y,w as i,h as T,a as d,s as k,E as f,o as h,F as V,l as v,f as P}from"./app-DKCKL3Mw.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const C={class:"space-y-6 p-5"},j={class:"border-b pb-4 text-lg font-bold text-gray-900"},N={class:"px-2"},B={class:"space-y-4 rounded-lg border border-gray-100 bg-gray-50 p-6 text-sm dark:border-gray-700 dark:bg-gray-800"},F={class:"space-y-4"},M={class:"flex items-center justify-between gap-4"},Y={class:"font-medium text-gray-900 dark:text-white"},E={class:"flex items-center justify-between gap-4 border-t border-gray-200 pt-2 text-base dark:border-gray-700"},R={class:"font-bold text-gray-900 dark:text-white"},$={class:"flex justify-end space-x-3"},q={props:{propertyModal:{type:Object,default:null}},data(){var r,e;return{process:!1,loaded:!0,isValid:!1,form:{name:null,birth_date:null,school:null,school_grade:null},field:{name:{label:"Nama Lengkap Siswa",rules:[c.isRequired("Nama Lengkap Siswa")],error:null},birth_date:{label:"Tanggal Lahir",rules:[c.isRequired("Tanggal Lahir")],error:null},school:{label:"Sekolah",rules:[c.isRequired("Sekolah")],error:null,disabled:!1,loading:!1,options:[]},school_grade:{label:"Kelas",rules:[c.isRequired("Kelas")],error:null,disabled:!0,loading:!1,options:[]}},product:(e=(r=this.propertyModal)==null?void 0:r.data)==null?void 0:e.product}},watch:{"form.school"(){this.form.school?(this.form.school_grade=null,this.field.school_grade.disabled=!1,this.field.school_grade.options=this.form.school.grades):(this.form.school_grade=null,this.field.school_grade.disabled=!0,this.field.school_grade.options=[])}},methods:{optionSchool(r){this.field.school.loading=!0,k.get(route("guardian.admissionStudent.optionSchool",{search:r})).then(e=>{this.field.school.options=e.data,this.field.school.loading=!1}).catch(e=>{console.log(e),this.field.school.loading=!1})},submit(){this.$refs.checkoutForm.validate(r=>{var e,a;if(r){this.process=!0;let u=JSON.parse(JSON.stringify(this.form));u.school=(e=u.school)==null?void 0:e.uuid,u.school_grade=(a=u.school_grade)==null?void 0:a.uuid,k.post(route("guardian.admissionStudent.checkout"),u,{headers:{"Content-Type":"application/json"}}).then(t=>{let n=t.data.transaction_payment,m=t.data.snap_token;try{window.snap.pay(m,{onSuccess:l=>{this.processPayment(n,l),f({title:"Pembayaran Berhasil",message:"Terima kasih! Pembayaran Anda telah berhasil diproses.",type:"success"}),this.process=!1},onPending:l=>{this.processPayment(n,l),f({title:"Menunggu Pembayaran",message:"Pembayaran Anda telah dimasukkan ke dalam tagihan. Silakan selesaikan transaksi segera.",type:"warning"}),this.process=!1},onError:l=>{this.processPayment(n,l),f({title:"Pembayaran Gagal",message:"Terjadi kesalahan dalam proses pembayaran. Silakan coba lagi.",type:"error"}),this.process=!1},onClose:l=>{console.log(l),f({title:"Transaksi Ditutup",message:"Anda telah menutup pembayaran sebelum menyelesaikannya.",type:"info"}),this.process=!1}})}catch(l){this.process=!0,console.error(l)}}).catch(t=>{var n,m;if(f({title:"Error",message:"Terjadi kesalahan.",type:"error"}),(m=(n=t.response)==null?void 0:n.data)!=null&&m.errors)for(let l in t.response.data.errors)this.field[l].error=t.response.data.errors[l],this.$refs.checkoutForm.validateField(l)}).finally(()=>{this.process=!1})}})},processPayment(r,e){this.process=!0,k.post(route("guardian.transactionPayment.processPayment"),{transaction_payment:r.uuid,gateway_response:e},{headers:{"Content-Type":"application/json"}}).then(a=>{console.log(a.data.status),a.data.status&&setTimeout(()=>{this.close(),this.$inertia.reload()},2e3)}).catch(a=>{f({title:"Error",message:a,type:"error"})}).finally(()=>{this.process=!1})},close(){this.$emit("close")}}},J=Object.assign(q,{__name:"CheckoutForm",setup(r){return D.init(),(e,a)=>{var _;const u=p("el-input"),t=p("el-form-item"),n=p("el-date-picker"),m=p("el-option"),l=p("el-select"),S=p("el-form");return h(),b("div",C,[s("h2",j,g((_=r.propertyModal)==null?void 0:_.title),1),s("div",N,[e.loaded?(h(),y(S,{key:0,ref:"checkoutForm","label-position":"top",model:e.form,disabled:e.process},{default:i(()=>[d(t,{class:"font-bold",label:e.field.name.label,rules:e.field.name.rules,error:e.field.name.error,prop:"name"},{default:i(()=>[d(u,{modelValue:e.form.name,"onUpdate:modelValue":a[0]||(a[0]=o=>e.form.name=o),autocomplete:"off"},null,8,["modelValue"])]),_:1},8,["label","rules","error"]),d(t,{class:"font-bold",label:e.field.birth_date.label,rules:e.field.birth_date.rules,error:e.field.birth_date.error,prop:"birth_date"},{default:i(()=>[d(n,{modelValue:e.form.birth_date,"onUpdate:modelValue":a[1]||(a[1]=o=>e.form.birth_date=o),type:"date",format:"DD-MM-YYYY","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1},8,["label","rules","error"]),d(t,{class:"font-bold",label:e.field.school.label,rules:e.field.school.rules,error:e.field.school.error,prop:"school"},{default:i(()=>[d(l,{modelValue:e.form.school,"onUpdate:modelValue":a[2]||(a[2]=o=>e.form.school=o),placeholder:`Pilih ${e.field.school.label}`,"loading-text":"...","no-match-text":"Data tidak ditemukan","no-data-text":"Tidak ada data",disabled:e.field.school.disabled,"remote-method":e.optionSchool,"value-key":"uuid",remote:"",filterable:"","reserve-keyword":"",clearable:"",autocomplete:"off"},{default:i(()=>[(h(!0),b(V,null,v(e.field.school.options,o=>(h(),y(m,{key:o.uuid,label:o.area.name,value:o},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","disabled","remote-method"])]),_:1},8,["label","rules","error"]),d(t,{class:"font-bold",label:e.field.school_grade.label,rules:e.field.school_grade.rules,error:e.field.school_grade.error,prop:"school_grade"},{default:i(()=>[d(l,{modelValue:e.form.school_grade,"onUpdate:modelValue":a[3]||(a[3]=o=>e.form.school_grade=o),placeholder:`Pilih ${e.field.school_grade.label}`,"loading-text":"...","no-match-text":"Data tidak ditemukan","no-data-text":"Tidak ada data",disabled:e.field.school_grade.disabled,"value-key":"uuid",clearable:"",autocomplete:"off"},{default:i(()=>[(h(!0),b(V,null,v(e.field.school_grade.options,o=>(h(),y(m,{key:o.uuid,label:o.title,value:o},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","disabled"])]),_:1},8,["label","rules","error"])]),_:1},8,["model","disabled"])):T("",!0)]),s("div",B,[s("div",F,[s("dl",M,[a[4]||(a[4]=s("dt",{class:"font-normal text-gray-500 dark:text-gray-400"}," Harga ",-1)),s("dd",Y," IDR "+g(e.product.price),1)]),a[5]||(a[5]=s("dl",{class:"flex items-center justify-between gap-4"},[s("dt",{class:"font-normal text-gray-500 dark:text-gray-400"}," Diskon "),s("dd",{class:"font-medium text-green-500 dark:text-white"}," - ")],-1))]),s("dl",E,[a[6]||(a[6]=s("dt",{class:"font-bold text-gray-900 dark:text-white"},"Total",-1)),s("dd",R," IDR "+g(e.product.price),1)])]),s("div",$,[d(w,{class:"w-full",type:"light",onClick:e.close,disabled:e.process},{default:i(()=>a[7]||(a[7]=[P(" Batal ")])),_:1},8,["onClick","disabled"]),d(w,{class:"w-full",type:"default",onClick:e.submit,disabled:e.process},{default:i(()=>a[8]||(a[8]=[P(" Beli Formulir ")])),_:1},8,["onClick","disabled"])])])}}});export{J as default};
